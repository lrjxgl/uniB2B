(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-pm-detail"],{"4d72":function(t,e,i){"use strict";i("ac1f"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=!1,s=0,n={data:function(){return{list:[],t_userid:0,content:"",maxid:0,hasNew:0,per_page:0,isFirst:!0,sch:0,oldsch:0,scrollTop:1e4,time:0,timer:0}},onLoad:function(t){var e=uni.getSystemInfoSync();s=e.windowHeight,this.t_userid=t.userid,this.getPage()},onUnload:function(){clearInterval(this.timer),this.timer=0,console.log("close timer")},onHide:function(){clearInterval(this.timer),this.timer=0,console.log("close timer")},onShow:function(){this.setTimer()},onPageScroll:function(t){0!=t.scrollTop||a||(this.getList(),a=!0,setTimeout((function(){a=!1}),2e3))},methods:{scrollY:function(t){this.sch=t.detail.scrollHeight},scTop:function(t){0==this.oldsch&&(this.oldsch=this.sch);var e=this;e.scrollTop=0,this.getList()},setTimer:function(){var t=this;this.timer>0&&clearInterval(this.timer),this.timer=setInterval((function(){t.getNew()}),1e4)},getNew:function(){var t=this;t.app.get({url:t.app.apiHost+"/index.php?m=pm&a=getnew&ajax=1",data:{t_userid:t.t_userid},success:function(e){t.hasNew=e.data}})},getPage:function(){var t=this;t.app.get({url:t.app.apiHost+"/index.php?m=pm&a=detail&ajax=1",data:{t_userid:t.t_userid},success:function(e){t.setTimer(),t.isFirst=!1,t.hasNew=0,t.list=e.data.pmlist,t.per_page=e.data.per_page,uni.setNavigationBarTitle({title:e.data.t_nickname});setTimeout((function(){var e=uni.createSelectorQuery().in(t);e.select("#main").boundingClientRect((function(e){t.oldsch=e.height})).exec(),uni.pageScrollTo({scrollTop:t.scrollTop+10,duration:1})}),30)}})},getList:function(){var t=this;if(0==t.per_page&&!t.isFirst)return!1;t.app.get({url:t.app.apiHost+"/index.php?m=pm&a=detail&ajax=1",data:{t_userid:t.t_userid,per_page:t.per_page},success:function(e){t.setTimer(),t.hasNew=0,t.per_page=e.data.per_page;var i=t.list;for(var a in e.data.pmlist)i.unshift(e.data.pmlist[a]);t.list=i,setTimeout((function(){t.scrollTop+=10}),100),setTimeout((function(){var e=uni.createSelectorQuery().in(t);e.select("#main").boundingClientRect((function(e){if(0==t.oldsch)uni.pageScrollTo({scrollTop:1e5,duration:1});else{var i=e.height-t.oldsch-s+160;uni.pageScrollTo({scrollTop:i,duration:1})}t.oldsch=e.height})).exec()}),10)}})},sendPm:function(){var t=this;t.app.post({url:t.app.apiHost+"/index.php?m=pm&a=sendSave&ajax=1",data:{t_userid:t.t_userid,content:t.content},success:function(e){if(e.error)return uni.showToast({title:e.message}),!1;t.content="",t.getPage()}})}}};e.default=n},"5e72":function(t,e,i){"use strict";var a;i.d(e,"b",(function(){return s})),i.d(e,"c",(function(){return n})),i.d(e,"a",(function(){return a}));var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",{attrs:{id:"main"}},[t.hasNew>0?i("v-uni-view",{staticClass:"fixNotice",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.getPage.apply(void 0,arguments)}}},[t._v("你有"+t._s(t.hasNew)+"条新消息")]):t._e(),0==Object.keys(t.list).length?i("v-uni-view",{staticClass:"emptyData"},[t._v("暂无私信")]):t._e(),i("v-uni-view",{staticClass:"pmList"},t._l(t.list,(function(e,a){return i("v-uni-view",{key:a,staticClass:"row-box mgb-5"},[e.isme?i("v-uni-view",{staticClass:"flex flex-ai-center"},[i("div",{staticClass:"flex-1"},[i("div",{staticClass:"flex"},[i("div",{staticClass:"f12 cl3"},[t._v(t._s(e.timeago))]),i("div",{staticClass:"flex-1"}),i("div",{staticClass:"mgl-5 f12 cl3"},[t._v("我")])]),i("div",{staticClass:"pm-r-msg"},[t._v(t._s(e.content))])]),i("img",{staticClass:"pm-head mgl-5",attrs:{src:e.user_head+".100x100.jpg"}})]):i("v-uni-view",{staticClass:"flex flex-ai-center"},[i("img",{staticClass:"pm-head mgr-5",attrs:{src:e.t_user_head+".100x100.jpg"}}),i("div",{staticClass:"flex-1"},[i("div",{staticClass:"flex mgb-5"},[i("div",{staticClass:"mgb-5 f12 cl3"},[t._v(t._s(e.t_nickname))]),i("div",{staticClass:"flex-1"}),i("div",{staticClass:"f12 cl3"},[t._v(t._s(e.timeago))])]),i("div",{staticClass:"pm-l-msg"},[t._v(t._s(e.content))])])])],1)})),1),i("v-uni-view",{staticClass:"ftBox-row"}),i("v-uni-view",{staticClass:"ftBox"},[i("v-uni-input",{staticClass:"ftBox-text",attrs:{type:"text"},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}}),i("v-uni-view",{staticClass:"ftBox-btn",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.sendPm.apply(void 0,arguments)}}},[t._v("发布")])],1)],1)},n=[]},"701c":function(t,e,i){"use strict";i.r(e);var a=i("5e72"),s=i("a3df");for(var n in s)"default"!==n&&function(t){i.d(e,t,(function(){return s[t]}))}(n);i("fb06");var o,r=i("f0c5"),c=Object(r["a"])(s["default"],a["b"],a["c"],!1,null,"59fee414",null,!1,a["a"],o);e["default"]=c.exports},a3df:function(t,e,i){"use strict";i.r(e);var a=i("4d72"),s=i.n(a);for(var n in a)"default"!==n&&function(t){i.d(e,t,(function(){return a[t]}))}(n);e["default"]=s.a},a881:function(t,e,i){var a=i("24fb");e=a(!1),e.push([t.i,".fixNotice[data-v-59fee414]{position:fixed;opacity:.8;top:44px;left:0;right:0;background-color:#fff;padding:6px;color:red;text-align:center}.pm-head[data-v-59fee414]{width:40px;height:40px;margin-right:5px}.pm-l-msg[data-v-59fee414],.pm-r-msg[data-v-59fee414]{color:#646464;font-size:14px;padding:10px 5px;box-sizing:border-box;background-color:#eee;border-radius:5px}.pm-l-msg[data-v-59fee414]{margin-right:50px}.pm-r-msg[data-v-59fee414]{margin-left:50px;text-align:right}.ftBox[data-v-59fee414]{display:flex;flex-direction:row;position:fixed;bottom:0;left:0;right:0;background-color:#fff;padding:5px}.ftBox-text[data-v-59fee414]{box-sizing:border-box;height:36px;line-height:36px;border:1px solid #eee;flex:1;padding:5px;color:#323232;font-size:14px}.ftBox-btn[data-v-59fee414]{box-sizing:border-box;height:36px;line-height:36px;border-top-right-radius:5px;border-bottom-right-radius:5px;background-color:#15aba5;color:#fff;padding:0 10px}.ftBox-row[data-v-59fee414]{height:44px}",""]),t.exports=e},b536:function(t,e,i){var a=i("a881");"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var s=i("4f06").default;s("1cdb3694",a,!0,{sourceMap:!1,shadowMode:!1})},fb06:function(t,e,i){"use strict";var a=i("b536"),s=i.n(a);s.a}}]);